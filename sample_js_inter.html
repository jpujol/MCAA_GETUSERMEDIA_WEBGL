<html>
<body>
<video id="webcam" style="display:none;"></video>
<canvas id="feed"></canvas>
<canvas id="display"></canvas>

<script>

// Override the function with all the posibilities
navigator.getUserMedia ||
        (navigator.getUserMedia = navigator.mozGetUserMedia ||
        navigator.webkitGetUserMedia || navigator.msGetUserMedia);
    
    window.requestAnimationFrame ||
        (window.requestAnimationFrame = window.webkitRequestAnimationFrame || 
            window.mozRequestAnimationFrame || 
            window.oRequestAnimationFrame || 
            window.msRequestAnimationFrame || 
            function( callback ){
                window.setTimeout(callback, 1000 / 60);
            });

var video = document.getElementById('webcam');
var  feed = document.getElementById('feed'),
     feedContext = feed.getContext('2d'),
     display = document.getElementById('display'),
     displayContext = display.getContext('2d');
 var num_frames = 0;
 var old_time = Date.now();
 <!-- callbacks for getusermedia -->
function onSuccess(stream) {
    var videoSource;

    if (window.webkitURL) {
        videoSource = window.webkitURL.createObjectURL(stream);
    } else {
        videoSource = stream;
    }
    video.src = videoSource;
    video.play();

    display.width = feed.width = 640;
    display.height = feed.height = 480;

    streamFeed();
}

function onError() {
    alert('There has been a problem retreiving the streams - are you running on file:/// or did you disallow access?');
} 
var acum_image = null;
function ProcessImage1(data) {

  if (acum_image != null)
    for (var i = 0; i < data.length; i ++) {        
      data[i] = data[i] * 0.1 + acum_image[i] * 0.9;
    }
  acum_image = new Uint8ClampedArray(data);
}

function streamFeed() {
    requestAnimationFrame(streamFeed);
    feedContext.drawImage(video, 0, 0, display.width, display.height);
    var myImage = feedContext.getImageData(0, 0, display.width, display.height);
    ProcessImage1(myImage.data);
    displayContext.putImageData(myImage, 0, 0);
    num_frames++;
    var frames_control = 10;
    if (num_frames % frames_control == 0) {
       var current_time = Date.now();
       console.log("Fps = %f\n", 1000 * frames_control /(current_time - old_time));
       old_time = current_time;
    }
    
}

 
function requestStreams() {
    var getVideo = true;
    var getAudio = false;
    navigator.getUserMedia({video: getVideo, audio: getAudio}, 
        onSuccess, onError);
}

// Start execution
requestStreams();
</script>


</body>
</html>
